#!/usr/bin/env bash

log_error() {
    echo $1 1>&2
    exit 1
}

workspaces_sed_correction() {
    set -ex; \
        sed -i '/core\/integration-tests/d' Cargo.toml; \
        sed -i '/apps\/desktop\/src-tauri/d' Cargo.toml
}

# Change all versions in package.json files AND Cargo.toml files to 'nightly'
nightly_sed_correction() {
    set -ex; \
        sed -i 's|version = ".*"|version = "nightly"|g' Cargo.toml; \
        sed -i 's|"version": ".*"|"version": "nightly"|g' package.json
}

# Change all versions in package.json files AND Cargo.toml files to 'experimental'
experimental_sed_correction() {
    set -ex; \
        sed -i 's|version = ".*"|version = "experimental"|g' Cargo.toml; \
        sed -i 's|"version": ".*"|"version": "experimental"|g' package.json
}

download_pdfium() {
    local arch=$1
    if [ "$arch" = "amd64" ]; then
        curl -sLo pdfium.tgz https://github.com/bblanchon/pdfium-binaries/releases/chromium/6002/pdfium-linux-x86.tgz
    elif [ "$arch" = "arm64" ]; then
        curl -sLo pdfium.tgz https://github.com/bblanchon/pdfium-binaries/releases/download/chromium/6002/pdfium-linux-arm64.tgz
    fi
    tar -xzvf pdfium.tgz -C /pdfium
    rm pdfium.tgz
}